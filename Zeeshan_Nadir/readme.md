# Pedestrian Detection and Tracking using Kalman Filter and KLT Tracker

Pedestrian detection and tracking is an important problem in the field of computer vision and is still being researched. Similar it may sound, but pedestrian detection and tracking are two separate problems. In this description, I shall discuss both the two problems, give a brief literature survey and then describe the approach that I have taken to tackle these problems. I shall then provide a unified framework for pedestrian detection and tracking in real time video sequences.

Pedestrian detection and tracking problem is defined as keeping track of existing pedestrians in the video and finding new pedestrians as they become visible. Typically, the detection part is posed as a machine learning problem where a set of features are chosen to distinguish between pedestrian and non-pedestrian images and are then fed to a classifier such as [Support Vector Machines](http://docs.opencv.org/2.4/modules/ml/doc/support_vector_machines.html). In 2005, Navneet and Dalal popularized [Histogram of gradients (HOG)](https://lear.inrialpes.fr/people/triggs/pubs/Dalal-cvpr05.pdf) as a set of features for their effectivity in pedestrian detection problems. In this paper, we shall use HOG based pedestrian detector along with a linear Support vector machine to detect pedestrians. Major challenges that are faced in pedestrian detection are occlusion, non-rigid nature of pedestrians and slanted pose angles of pedestrians with respect to the camera. The result of these challenges are missed detections (false negatives) and detections of non-pedestrian regions of images as pedestrians (false positives).

Once an object is detected in a particular frame of a video sequence, we want to keep a track of this detected object. Therefore, as we receive new frame, we want to mark the location of the pedestrians in earlier frames. Major challenges of tracking the pedestrians in videos include partial and full occlusion, abrupt motion of pedestrians, changing appearance of objects due to change in pose, illumniation etc., changing appearance of the scene, non-rigid object structures. Furthermore, because of such challenges, we may also have missed detections of already existing pedestrians in the video. The result of these challenges is abrupt stops in the tracks of pedestrians, abrupt changes in the tracks of pedestrians, noisy tracks and missing tracks. 

In order to tackle the challenges faced in tracking the pedestrians, pedestrian tracking methods typically incorporate dynamic models and appearance models. Dynamic models help in missing the "gaps" in the tracks of predictions for example in case of occlusion or missed detections. They also help in smoothing out the track of pedestrians. In essence, dynamic models constrain the motion of the pedestrians by using prior information in terms of how the pedestrians move e.g., linear motion models assume a constant velocity. This may or may not be a very accurate assumption, however, it tends to be a good model especially for making predictions near in time. In contrast to dynamic models, appearance models define the apperance of the object in terms of features that can be computed inexpensively. Color histograms and corner points are popular features that are used in apperance models. The main purpose of appearance models is to solve the data association problem i.e., given multiple detections in frame n, how do we associate these detections with the existing pedestrians from frame n-1. In this work, I shall use both dynamic model and appearance model to track pedestrians. The following flow chart gives provides a visual description of how each of these two models are used in tracking.

![picture3](https://user-images.githubusercontent.com/29146711/29339017-ccfef8c0-81dd-11e7-852c-44a6f59c8680.png)

The rest of the read me documentation is organized as follows:
1. Pedestrian Detection
2. Background Subtraction
3. Kalman Filtering
4. Kanade Lucas Tomasi (KLT) Tracker
5. Detection and Tracking Algorithm
6. Results

## Pedestrian Detection using HOG Features and Linear SVM
Generally, a basic object detection problem is defined as finding a given object of interest in any given image of a fixed size. Therefore, given an image of predefined size, the object detector must decide if the image is of the object of interest or not. However, in practice, real images can have the objects of interest in any possible location inside the image. Morever, the size of the object in real images need not be equal to the predefined size, that is, the object can be at different scale levels (zoom levels) inside the image. In order to cope with this, we use a basic object detector and use sliding window and scale space to try to detect objects inside the images. In the context of pedestrian detection, what it means is that given any monocular image that may or may not contain pedestrians, we want to detect pedestrians inside this image and indicate it's location by drawing a (preferably tight) bouding box around the pedestrian. One of the most popular method to detect pedestrians is based on [Histogram of Gradients (HOG)](https://lear.inrialpes.fr/people/triggs/pubs/Dalal-cvpr05.pdf) by Navneet and Dalal. We shall be using HOG in our work to detect pedestrians.


## Pedestrian Tracking using Kalman Filter and KLT Tracker
A tracking problem by nature works with video signals. Generally, a basic tracking problem is defined as tracking a fixed object inside a video signal. In practice, however, we may want to track multiple objects that may or may not get occluded due to each other or due to other objects that are part of the scene of the video. There are many different approaches to track objects in videos including Point Tracking e.g., [Kalman Filter](https://en.wikipedia.org/wiki/Kalman_filter), Kernel Tracking e.g., [Kanade Lucas Tomasi (KLT) Tracker](https://en.wikipedia.org/wiki/Kanade%E2%80%93Lucas%E2%80%93Tomasi_feature_tracker), and Silhouette Tracking e.g., shape and contour based models. In this work, we shall be using Kalman Filtering and KLT tracking to track pedestrians. Though these methods are not new, however, the important challenge comes in how we combine these two tracking methods to have a robust tracking mechanism that gives good performance while still being in the realm of real time processing. 

Following figure shows the workflow of pedestrian detection and tracking problem:

![picture2](https://user-images.githubusercontent.com/29146711/29292918-9f1ccc86-810e-11e7-91b0-5aff9223e8a2.png)
We detect pedestrians in the input video frames, and then track the pedestrians by updating their current location. Even if we are not able to detect the pedestrian in the input frame, we can use the current location to perform detection as shown by the feedback loop in the above figure. In practice, however, performing detection on each of the input video frames may be computationally prohibitive to yield real time processing results. Therefore, we use an additional preprocessing step of [Background Subtraction](http://docs.opencv.org/3.1.0/db/d5c/tutorial_py_bg_subtraction.html). This removes all the background clutter from the video frame, thereby helping us focus computations on the regions in the image belonging to the foreground. 
 

